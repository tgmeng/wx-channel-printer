<script lang="ts" setup>
import { ref } from "vue";
import { WxChannelShopPrinter } from "../src/index";
import { PrinterData } from "../dist/types";

const selectedPrinter = ref<PrinterData | null>(null);
const printerList = ref<PrinterData[]>([]);
const printContent = ref(
  "JTdCJTIycHJpbnREYXRhJTIyJTNBJTdCJTIyd2F5YmlsbElkJTIyJTNBJTIyNzM1MDgxOTAyNjUyMzYlMjIlMkMlMjJwcmludFRpbWUlMjIlM0ElMjIyMDIzJTJGMDklMkYxNCUyMDIyJTNBNDMlMjIlMkMlMjJzZXJ2aWNlcyUyMiUzQSU1QiU1RCUyQyUyMnJlY2VpdmVyTmFtZSUyMiUzQSUyMiVFOSVCRSU5QSolRTYlOUQlQjAlMjIlMkMlMjJyZWNlaXZlclBob25lJTIyJTNBJTIyMTg5KioqKjk0MTIlMjIlMkMlMjJyZWNlaXZlckFkZHJlc3MlMjIlM0ElMjIlRTYlQjUlOTklRTYlQjElOUYlRTclOUMlODElRTYlOUQlQUQlRTUlQjclOUUlRTUlQjglODIlRTglQTUlQkYlRTYlQjklOTYlRTUlOEMlQkElRTglQTUlQkYlRTYlQkElQUElRTglQjclQUY2OTglRTUlOEYlQjclRTUlOEQlOEUlRTYlQjMlQjAlRTUlODglOUIlRTQlQjglOUElRTUlOUIlQUQlRTYlOUQlQUQlRTUlQjclOUUlRTYlOUMlODklRTglQjUlOUUlRTUlOEElOUUlRTUlODUlQUMlRTYlQTUlQkMlMjIlMkMlMjJzZW5kZXJOYW1lJTIyJTNBJTIya2slMjIlMkMlMjJzZW5kZXJQaG9uZSUyMiUzQSUyMjEzMTIzOTIwMTgwJTIyJTJDJTIyc2VuZGVyQWRkcmVzcyUyMiUzQSUyMiVFNiVCNSU5OSVFNiVCMSU5RiVFNyU5QyU4MSVFNiU5RCVBRCVFNSVCNyU5RSVFNSVCOCU4MiVFOCVBNSVCRiVFNiVCOSU5NiVFNSU4QyVCQSVFOSVCQiU4NCVFOSVCRSU5OSVFNSU5QiVCRCVFOSU5OSU4NSVFNCVCOCVBRCVFNSVCRiU4MyUyMiUyQyUyMnNpdGVDb2RlJTIyJTNBJTIyNTcxMjklMjIlMkMlMjJld2F5YmlsbE9yZGVySWQlMjIlM0ElMjIzMTA1NjIyNjg5ODY5OTM4NjkwJTIyJTJDJTIyYmFnQWRkciUyMiUzQSUyMiVFNiU5RCVBRCVFNSVCNyU5RSUyMiUyQyUyMm1hcmslMjIlM0ElMjIzMjBBSi0lMjBDMTUlMjBYMDIlMjIlMkMlMjJwcm9kdWN0Q250JTIyJTNBMTAwMCUyQyUyMnN0b3JlTmFtZSUyMiUzQSUyMiVFOCVCNSU5RSVFNyU5QSU4NCVFNSVBNSVCRCVFOCVCNCVBNyVFNSVCQSU5NyUyMiUyQyUyMmN1c3RvbWVyTm90ZXMlMjIlM0ElMjIlMjIlMkMlMjJvcmRlcklkJTIyJTNBJTIyMzcxNDM0MjAxODQxMDQ4MDg5NiUyMiUyQyUyMnByb2R1Y3RJbmZvc1dpdGhQYXJhbUFuZFNrdSUyMiUzQSU1QiUyMkNJLVFEJTIwQTQlRTYlOTYlODclRTQlQkIlQjYlRTglQTIlOEIlRTklODAlOEYlRTYlOTglOEUlRTUlQTElOTElRTYlOTYlOTklRTUlOEElQTAlRTUlOEUlOUElRTUlQTQlQTclRTUlQUUlQjklRTklODclOEYlRTYlOEMlODklRTYlODklQTMlRTglQUYlOTUlRTUlOEQlQjclRTYlOTQlQjYlRTclQkElQjMlRTglQTIlOEIlMjAlMjAxNjUwNjc4ODk5JTIwMTAwMCVFNCVCQiVCNiUyMiU1RCUyQyUyMnByb2R1Y3RJbmZvc1dpdGhQYXJhbSUyMiUzQSU1QiUyMkNJLVFEJTIwQTQlRTYlOTYlODclRTQlQkIlQjYlRTglQTIlOEIlRTklODAlOEYlRTYlOTglOEUlRTUlQTElOTElRTYlOTYlOTklRTUlOEElQTAlRTUlOEUlOUElRTUlQTQlQTclRTUlQUUlQjklRTklODclOEYlRTYlOEMlODklRTYlODklQTMlRTglQUYlOTUlRTUlOEQlQjclRTYlOTQlQjYlRTclQkElQjMlRTglQTIlOEIlMjAlMjAxMDAwJUU0JUJCJUI2JTIyJTVEJTJDJTIycHJvZHVjdEluZm9zT25seSUyMiUzQSU1QiUyMkNJLVFEJTIwQTQlRTYlOTYlODclRTQlQkIlQjYlRTglQTIlOEIlRTklODAlOEYlRTYlOTglOEUlRTUlQTElOTElRTYlOTYlOTklRTUlOEElQTAlRTUlOEUlOUElRTUlQTQlQTclRTUlQUUlQjklRTklODclOEYlRTYlOEMlODklRTYlODklQTMlRTglQUYlOTUlRTUlOEQlQjclRTYlOTQlQjYlRTclQkElQjMlRTglQTIlOEIlMjAxMDAwJUU0JUJCJUI2JTIyJTVEJTJDJTIyc3VtUHJvZHVjdENudCUyMiUzQTEwMDAlN0QlMkMlMjJ0ZW1wbGF0ZSUyMiUzQSU3QiUyMmNvZGUlMjIlM0EwJTJDJTIydGVtcGxhdGVJZCUyMiUzQSUyMjY2MjAyNzYxNDklMjIlMkMlMjJ0ZW1wbGF0ZU5hbWUlMjIlM0ElMjIlRTYlOUMlODklRTglQjUlOUUlMjIlMkMlMjJ0ZW1wbGF0ZURlc2MlMjIlM0ElMjIlRTQlQjglODAlRTglODElOTQlRTUlOEQlOTUlRTYlQTAlODclRTUlODclODYlRTYlQTglQTElRTYlOUQlQkYlMjIlMkMlMjJ0ZW1wbGF0ZVR5cGUlMjIlM0ElMjJzaW5nbGUlMjIlMkMlMjJvcHRpb25MaXN0JTIyJTNBJTdCJTIyaGFzR29vZEluZm8lMjIlM0FmYWxzZSUyQyUyMmhhc09yZGVySWQlMjIlM0FmYWxzZSUyQyUyMmhhc09yZGVyVGltZSUyMiUzQWZhbHNlJTJDJTIyaGFzQnV5ZXJNZXNzYWdlJTIyJTNBZmFsc2UlMkMlMjJoYXNTZWxsZXJTdG9yZU5hbWUlMjIlM0FmYWxzZSUyQyUyMmhhc1NlbGxlck5vdGUlMjIlM0FmYWxzZSU3RCUyQyUyMmNyZWF0ZVRpbWUlMjIlM0ElMjIxNjk0NjkzNjUzJTIyJTJDJTIydXBkYXRlVGltZSUyMiUzQSUyMjE2OTQ2OTM2NTMlMjIlMkMlMjJpc0RlZmF1bHQlMjIlM0F0cnVlJTJDJTIyb3B0aW9ucyUyMiUzQSU1QiU3QiUyMm9wdGlvbklkJTIyJTNBMCUyQyUyMmZvbnRTaXplJTIyJTNBMCUyQyUyMmlzQm9sZCUyMiUzQWZhbHNlJTJDJTIyaXNPcGVuJTIyJTNBdHJ1ZSU3RCUyQyU3QiUyMm9wdGlvbklkJTIyJTNBMSUyQyUyMmZvbnRTaXplJTIyJTNBMCUyQyUyMmlzQm9sZCUyMiUzQWZhbHNlJTJDJTIyaXNPcGVuJTIyJTNBdHJ1ZSU3RCUyQyU3QiUyMm9wdGlvbklkJTIyJTNBMiUyQyUyMmZvbnRTaXplJTIyJTNBMCUyQyUyMmlzQm9sZCUyMiUzQWZhbHNlJTJDJTIyaXNPcGVuJTIyJTNBZmFsc2UlN0QlMkMlN0IlMjJvcHRpb25JZCUyMiUzQTMlMkMlMjJmb250U2l6ZSUyMiUzQTAlMkMlMjJpc0JvbGQlMjIlM0FmYWxzZSUyQyUyMmlzT3BlbiUyMiUzQWZhbHNlJTdEJTJDJTdCJTIyb3B0aW9uSWQlMjIlM0E0JTJDJTIyZm9udFNpemUlMjIlM0EwJTJDJTIyaXNCb2xkJTIyJTNBZmFsc2UlMkMlMjJpc09wZW4lMjIlM0FmYWxzZSU3RCUyQyU3QiUyMm9wdGlvbklkJTIyJTNBNSUyQyUyMmZvbnRTaXplJTIyJTNBMCUyQyUyMmlzQm9sZCUyMiUzQWZhbHNlJTJDJTIyaXNPcGVuJTIyJTNBZmFsc2UlN0QlMkMlN0IlMjJvcHRpb25JZCUyMiUzQTYlMkMlMjJmb250U2l6ZSUyMiUzQTAlMkMlMjJpc0JvbGQlMjIlM0FmYWxzZSUyQyUyMmlzT3BlbiUyMiUzQWZhbHNlJTdEJTJDJTdCJTIyb3B0aW9uSWQlMjIlM0E3JTJDJTIyZm9udFNpemUlMjIlM0EwJTJDJTIyaXNCb2xkJTIyJTNBZmFsc2UlMkMlMjJpc09wZW4lMjIlM0FmYWxzZSU3RCU1RCUyQyUyMmRlbGl2ZXJ5SWQlMjIlM0ElMjJaVE8lMjIlMkMlMjJ0ZW1wbGF0ZVVybCUyMiUzQSUyMmh0dHBzJTNBJTJGJTJGcmVzLnd4LnFxLmNvbSUyRnNob3AlMkZwdWJsaWMlMkZmNjViM2Q0NC1kNDkwLTRkZGItYWZkZC1lYzk1MTJlMTUxYjIuaHRtbCUyMiU3RCU3RA"
);

const printer = new WxChannelShopPrinter();
globalThis.printer = printer;

printer.getPrinterList().then(list => {
  printerList.value = list;
});

printer.getAppInfo().then(appInfo => {
  console.log(appInfo);
});

const selectPrinter = (printer: PrinterData) => {
  selectedPrinter.value = printer;
};

const print = () => {
  if (!selectedPrinter.value) {
    alert("请选择打印机");
    return;
  }

  printer.print({
    version: "2",
    taskList: [
      {
        printInfo: printContent.value,
        printNum: {
          sumNum: 1,
          curNum: 1,
        },
      },
    ],
    printer: selectedPrinter.value.name,
  });
};
</script>

<template>
  <div>
    <li v-for="printer in printerList" @click="selectPrinter(printer)">
      {{ printer.displayName }}
    </li>
  </div>

  <div v-if="selectedPrinter">
    <p>当前选择打印机：{{ selectedPrinter.displayName }}</p>
    <textarea v-model="printContent"></textarea>
    <button v-if="printContent?.length > 0" @click="print">Print</button>
  </div>
</template>
